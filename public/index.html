<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Impulse Build</title>
    <!-- One Signal Setup -->
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script>
    <script>
      window.OneSignal = window.OneSignal || [];
      OneSignal.push(() => {
        OneSignal.init({
          appId: 'bb61f28f-3261-471b-897f-94ac0127add6',
          requiresUserPrivacyConsent: false,
          autoResubscribe: true,
          autoRegister: true,
          notifyButton: {
            enable: true,
            text: 'Enable Push Notifications',
          },
        });
      });
    </script>
    <style type="text/css">
      body {
        margin: 40px auto;
        max-width: 650px;
        line-height: 1.6;
        font-size: 18px;
        color: #444;
        padding: 0 10px;
        font-family: sans-serif;
      }
      h1,h2,h3 { line-height:1.2 }
      .user-id {
        font-size: 2em;
      }
    </style>
  </head>
  <body>
    <h1>
      Impulse
    </h1>

    <p>Impulse is a tool that sends a push notfication to your browser when a command completes.
      For more information visit: <a href="https://github.com/shekohex/impulse">https://github.com/shekohex/impulse</a>.
    </p>

    <h2>Your Subscription</h2>

    <p>
      After subscribing to Push Notifications you should see your User ID below.
      Copy it and set the <code>IMPULSE_USER_IDS</code> environment variable with
      the value.
    </p>

    <div class="user-id">
      <strong>User ID:</strong>
      <span id="user_id">Fetching User ID&hellip;</span>
    </div>

    <script>
      const USER_ID_NODE = document.getElementById('user_id');
      OneSignal.push(() => {
        OneSignal.getUserId((userId) => {
          USER_ID_NODE.textContent = userId;
          console.log('OneSignal User ID:', userId);
        });
      });
      // to refresh the page after user subscription change
      OneSignal.push(() => {
        OneSignal.on('subscriptionChange', (isSubscribed) => {
          console.log("The user's subscription state is now:", isSubscribed);
          location.reload();
        });
      });
    </script>
  </body>
</html>
